# EC2 101

## EC2 Options

1. On Demand:  Fixed rate by the hour with no commitments.
  * Usage scenarios:  
    * Flexibility; no long term commitments;
    * Short term applications; spiky or unpredictable workloads that cannot be interrupted
    * Applications being developed or tested for the first time; dev/text
      environments

      Use on demand instances to supplement reserved instances during usage spikes


1. Reserved:  reserve capacity  1 or 3 year terms.
  * Usage scenarios:
    * Applications that are in steady state or predictable usage
    * Users are able to make up front payments for 1 or 3 years
    * E.g. You have 10K "regular" users requiring 2 large instances but require extra instances (on demand) for 
    Black Friday traffic

1. Spot:  bid whatever price you want for instance capacity; if the market price
   goes above your bid, you are given an hour notice and Amazon terminates the
   instance.
   * Usage scenarios:
     * Applications that have flexible start and end times
     * Applications that are only feasible at very low compute prices
     * Users with urgent computing needs for large amounts of additional capacity
     * Most commercially feasible
     * **Spot instances terminated by AWS, no charge for the hour**
     * **Spot instances terminated by you, you are charged for the hour**

1. Dedicated hosts:  Dedicated physical EC2 instances
  * Usage scenarios:
    * Dedicated servers needed for existing per-server license
    * Regulatory requirements that forbid multi-tenant virtualization
    * Can be purchased On Demand (hourly) or Reserved 


## EC2 Instance Families

![EC2 Instance Families](https://github.com/MathewT/aws-certified-developer/blob/master/EC2/instance-families.png)


## EBS Elastic Block storage
  1. S3 is object storage.  
  1. EBS is block storage for creating storage volumes that
    can be attached to EC2 instances.   
  1. Once the EBS-based storage vol attached to an EC2 instance, you can
    create a file system on top of these volumes, run a database or use them in
    any way you would use a block device.   
  1. EBS volumes are placed in specific availability zones where they are automatically
    replicated.
  1. Think: Disk in the cloud.
  1. One EC2 can attach multiple EBS volumes
  1. An EBS volume can only be mounted by one single EC2 instance; you cannot mount one EBS volume to 
  multiple EC2 instances; use EFS instead

**EBS Types**
  1. GP2 - General Purpose SSD
    * Designed for 99.999 availability
    * Ratio of 3 IOPS per GB, up to 10,000 IOPS, burst to 3000 for short 
    periods for volumes under 1GB
  1. IO1 - Provisioned IOPS
    * For I/O intensive applications, large relational or NoSQL databases,
    * For more than 10,000 IOPS
  1. ST1 Magnetic HDD
    * Large amounts of sequential data (data written in squence)
    * Big data
    * Data warehouse
    * Log processing
    * Not for randomly stored data requiring disk seeks
    * Sequential throughput optimized
    * **Cannot be a boot volume**
  1. SC1 Cold HDD
    * Lower cost than ST1
    * For infrequently accessed workloads
    * File server
    * **Cannot be a boot volume**
  1. Magnetic Standard
    * Lowest cost of all EBS volume types that are *bootable*
    * **Bootable volume**
    * Infrequently accessed data
  
## Exam Tips:
  1. By default, the root volume cannot be encrypted when creating an EC2 instance via the console.
  1. The root volume can be encrypted via 3rd party tool (e.g. Bit Locker), or can be done when creating 
  an AMI via consol or API.
  1. Additional volumes can be encrypted on creation via the console.
  1. Termination Protection is turned off by default.  You must turn it on explicitly.
  1. On an EBS-backed EC2 instance, the default action is to delete the root EBS volume on instance termination.
  
## Security Groups
1. Security groups are a virtual firewall that determine inbound and outbound TCP/IP traffic rules
1. One EC2 instance can have multiple security groups
1. All inbound traffic is blocked by default
1. All outbound traffic is allowed by default
1. **Exam Tip:** Changes to security group rules take effect immediately
1. **Exam Tip:** Security group rules are **stateful**. If you create an inbound rule for ssh, http, https then corresponding 
outbound rules for those same ports/protocols are also created *even if not present or visible in the conosle*
1. SG rules cannot deny traffic, only allow traffic.  Denying specific traffic, IPs, ports, protocols is done via 
*Network Access Control Lists* (VPC)
1. NACLs are stateless

## Volumes and Snapshots
1. An EBS volume is a virtual hard disk
1. A created EBS volume must be in the same availability zone as the EC2 instance to which it will be attached
1. Root volume is the virtual hard disk on which the OS is installed
1. Snapshots are point-in-time copies
1. Snapshots physically exist on S3
1. Snapshots are incremental.  Only changed blocks are copied to S3 on subsequent snapshots

## RAID, Volumes and Snapshots
1. RAID 0 - Striped, no redundancy, 
  - when you need a greater level of performance for a file system than you can provision on a single Amazon EBS volume
  - when I/O performance is more important than fault tolerance
  - Example: Two 500 GiB Amazon EBS volumes with 4,000 provisioned IOPS each will create a 1000 GiB RAID 0 array with an available bandwidth of 8,000 IOPS and 640 MB/s of throughput or a 500 GiB RAID 1 array with an available bandwidth of 4,000 IOPS and 320 MB/s of throughput.
1. RAID 1 - Mirrored, redundancy
  - When fault tolerance is more important than I/O performance
1. RAID 5, 6 are NOT recommended by AWS because they are parity writes

## Create AMI
1. An AMI is a template for the root volume of an EC2 instance
1. Snapshot of a root device volume, stored in S3
1. **Exam Tip:** AMIs are regional.  They can only be launched from the region in which they are stored
1. AMIs can be copied to other regions using the console, AWS command line or EC2 API

## EBS Root Volumes vs Instance
1. Instance store - ephemeral storage
  - **EC2 instances using instance store root volumes cannot be stopped.  Only rebooted or terminated.**
  - If the underlying host fails, you will lose your data
  - Can provision more slowly than EBS
  - You can only add 1 additional instance store volume
  - By default, both root volumes will be deleted on instance termination but with EBS backed volumes, you 
  can tell AWS to keep the root volume
  


## Install AWSCLI

```sudo apt-get install python2.7```

```sudo apt-get install libssl-dev```

```sudo apt-get install python-pip```

```sudo pip install --upgrade pip```

```sudo pip install awscli```

http://docs.aws.amazon.com/cli/latest/userguide/installing.html#install-with-pip


## Install RVM, Ruby, AWS SDK

```sudo apt-get install git-core vim libssl-dev```

```gpg --keyserver hkp://keys.gnupg.net --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3```

```curl -L https://get.rvm.io | bash -s stable```

```source ~/.rvm/scripts/rvm```

```echo "source ~/.rvm/scripts/rvm" >> ~/.bashrc```

```rvm install 2.3.3```

AWS SDK Documentation for Ruby:  http://docs.aws.amazon.com/sdk-for-ruby/v2/developer-guide/

